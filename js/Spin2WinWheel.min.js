function Spin2WinWheel(){gsap.registerPlugin(InertiaPlugin,TextPlugin,Draggable);var p=function(a){return document.querySelector(a)},y=this,O=p(".wheelSVG"),f=p(".wheel"),Y=p(".wheelOutline"),Z=p(".wheelContainer"),P=p(".peg"),pa=p(".pegContainer"),Ra=p(".mainContainer"),A=p(".valueContainer"),qa=p(".centerCircle"),B=p(".toast"),ra=p(".toast p"),Sa=p(".centerCircleImageContainer"),b,sa,aa,ta,ba,q,ua,va,wa,xa,Q,C,G,ya,za,Aa,Ba,Ca,ca,da,Da,Ea,ea,m,u,v,k,Fa,R,H=0,d,e,I,n=0,D=2,S=0,J=0,fa=J,ha=[],K,ia,
Ga,ja,Ha,T,Ia,Ja,w,r=null,Ka,L=[],Ta=new Audio("media/wheel_tick.mp3"),g,E=!0,F,U,La,V=null,M=!1,ka,la,Ma,W=gsap.getProperty(".wheel"),Na=null,Oa=function(){gsap.set("svg",{visibility:"visible"});gsap.set(f,{svgOrigin:d+" "+e,x:0,y:0});gsap.set(P,{x:d-P.getBBox().width/2,y:e-q-P.getBBox().height/2,transformOrigin:"50% 25%",visibility:"visible"});gsap.set(pa,{transformOrigin:"50% 100%",scale:ba/600});gsap.set(Ra,{svgOrigin:d+" "+e,rotation:-90,x:0,y:0})},Ua=function(){var a=document.createElementNS("http://www.w3.org/2000/svg",
"image");a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Ca);a.setAttribute("width",ca);a.setAttribute("height",da);a.setAttribute("x",d-ca/2);a.setAttribute("y",e-da/2);Sa.appendChild(a)},Va=function(){if(0==v)showToast(Ma),r.onclick=null;else if(!M){if(0<g.length){E=!1;v=g.length;for(var a=0;a<g.length;a++){if(g[a]>u||0===g[a]){showInitError("Invalid destination set - please ensure the destination in spinDestinationArray is greater than 0 and less than or equal to the number of segments");
return}--g[a];g[a]=-1*g[a]*k-U*D;D+=2}}w?createClickToSpin():Pa();showIntroText()}},Xa=function(){for(var a,c,h,t,x,l,N,z=0;z<u;z++)J=-Fa,fa=J+k,a=d+q*Math.cos(Math.PI*J/180),h=e+q*Math.sin(Math.PI*J/180),c=d+q*Math.cos(Math.PI*fa/180),t=e+q*Math.sin(Math.PI*fa/180),x="M"+d+","+e+"  L"+a+","+h+"  A"+q+","+q+" 0 0,1 "+c+","+t+"z",N=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","path"),N.appendChild(l),f.appendChild(N),gsap.set(l,
{rotation:z*k,svgOrigin:d+" "+e}),l.setAttributeNS(null,"d",x),I[z]?x=I[z]:(x=I[S],S++,S==I.length&&(S=0)),l.setAttributeNS(null,"fill",x),l.setAttributeNS(null,"stroke",0),ha.push({path:l,x1:a,x2:c,y1:h,y2:t});if(0<ea)for(a=0;a<u;a++)c=document.createElementNS("http://www.w3.org/2000/svg","line"),c.setAttributeNS(null,"x1",d),c.setAttributeNS(null,"x2",ha[a].x2),c.setAttributeNS(null,"y1",e),c.setAttributeNS(null,"y2",ha[a].y2),c.setAttributeNS(null,"stroke",Ea),c.setAttributeNS(null,"stroke-width",
ea),f.appendChild(c),gsap.set(c,{svgOrigin:d+" "+e,rotation:a*k});Wa()},Wa=function(){for(var a=0;a<u;a++){var c=document.createElementNS("http://www.w3.org/2000/svg","g");if("image"==m[a].type){var h=document.createElementNS("http://www.w3.org/2000/svg","image");c.appendChild(h);h.setAttribute("class","wheelImage");h.setAttributeNS(null,"x",d-Q/2);h.setAttributeNS(null,"y",e-q+wa);h.setAttributeNS(null,"width",Q);h.setAttributeNS(null,"height",Q);h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",
m[a].value)}else if("string"==m[a].type){var t=document.createElementNS("http://www.w3.org/2000/svg","text"),x,l;m[a].value.split("^").forEach(function(N,z){x=document.createTextNode(N);l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttributeNS(null,"dy",z?"1.2em":0);l.setAttributeNS(null,"x",d);l.setAttributeNS(null,"text-anchor","middle");l.appendChild(x);t.appendChild(l)});c.appendChild(t);t.setAttribute("class","wheelText");t.setAttributeNS(null,"fill",ua);t.setAttributeNS(null,
"x",d);t.setAttributeNS(null,"y",e-q+va);t.style.fontSize=xa}A.appendChild(c);gsap.set(c,{svgOrigin:d+" "+e,rotation:a*k})}gsap.set(A,{svgOrigin:d+" "+e})},Ya=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","circle");Y.appendChild(a);c.setAttributeNS(null,"fill","transparent");c.setAttributeNS(null,"stroke",aa);c.setAttributeNS(null,"stroke-width",ta);c.setAttributeNS(null,"cx",d);c.setAttributeNS(null,"cy",e);c.setAttributeNS(null,
"r",q);a.appendChild(c);return a},Za=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"fill",Aa);a.setAttributeNS(null,"stroke",ya);a.setAttributeNS(null,"stroke-width",za);a.setAttributeNS(null,"cx",d);a.setAttributeNS(null,"cy",e);a.setAttributeNS(null,"r",Da);return a},$a=function(){Ta.play()},ab=function(){B.style.visibility="hidden"},Qa=function(){B.style.visibility="hidden";r.onclick=null;D+=2},bb=function(){Na=Math.abs(InertiaPlugin.getVelocity(f,
"rotation"));disableWheel();E&&(Ka=InertiaPlugin.track(f,"rotation"))},X=function(a){R=H;H=Math.round(W("rotation")/k);H!=R&&gsap.fromTo(P,{rotation:H>R?-35:35},{duration:.2,onStart:Ia?$a:null,rotation:0,ease:"back"});gsap.set(A,{rotation:W("rotation")})},cb=function(){G=W("rotation");var a=Math.round(G%360);a=0<a?360-a:a;a=0>a?a*=-1:a;if(Ka&&Na<=La)enableWheel(),showResult("invalidSpin");else{showResult(Math.abs(Math.round(a/k)));if(E)if(-1<v)n++;else return;else n++,C[0].vars.snap=[g[n]];InertiaPlugin.untrack(f);
n>=v?endGame():enableWheel()}},db=function(a){return function(c){return Math.round(c/k)*k-a}},Pa=function(){C=Draggable.create(f,{type:"rotation",bounds:{minRotation:-1E16*F,maxRotation:0},inertia:!0,ease:"back(0.2)",snap:E?db(0):[g[n]],throwResistance:0,minDuration:K,maxDuration:K,onThrowComplete:cb,onPress:ab,onDrag:X,onThrowUpdate:X,onDragEnd:bb})},fb=function(){M=!0;m.forEach(function(a,c){isNaN(a.probability)&&(M=!1)});M&&(g=[],v=-1==b.numSpins?1E16:parseInt(b.numSpins),eb())},eb=function(){var a=
0;m.forEach(function(c,h){a+=c.probability});ka=a;Math.ceil(a)==ka||Math.floor(a)==ka?createProbabilityArray():1==confirm("Total probability: "+a+" - If you have set JSON probability values they must add up to 100")&&(gsap.set(Z,{autoAlpha:0}),gsap.set(Z,{autoAlpha:0}))};createProbabilityArray=function(){V=[];m.forEach(function(a,c){for(var h=0;h<a.probability;h++)V.push(c)})};showProbabilityError=function(){};createClickToSpin=function(){fb()&&createProbabilityArray();r?r.onclick=getTrigger():(r=
f,f.onclick=getTrigger())};getTrigger=function(){return function(){if(M){var a=gsap;a.to.call(a,f,{inertia:{duration:{min:K,max:ia},rotation:{velocity:F*Math.floor(201*Math.random()+-700),end:-(k*V[Math.floor(Math.random()*V.length)])-U*D}},onStart:Qa,onUpdate:X,ease:Back.easeOut.config(.2),onComplete:spinComplete})}else a=gsap,a.to.call(a,f,{inertia:{duration:{min:K,max:ia},rotation:{velocity:F*Math.floor(201*Math.random()+-700),end:E?-(k*Math.floor(Math.random()*(u-0+1)))-U*D:[g[n]]}},onStart:Qa,
onUpdate:X,ease:Back.easeOut.config(.2),onComplete:spinComplete})}};spinComplete=function(){G=W("rotation");var a=Math.round(G%360);a=0<a?360-a:a;a=0>a?a*=-1:a;showResult(Math.abs(Math.round(a/k)));if(E)if(-1<v)n++;else return;else n++;n>=v?endGame():r.onclick=getTrigger()};endGame=function(){disableWheel();gsap.set(O,{opacity:.3});gsap.to(ra,{duration:1,text:Ga,ease:Linear.easeNone,delay:2});ma({gameId:T,target:y,results:L})};disableWheel=function(){w||C[0].disable()};enableWheel=function(){w||C[0].enable()};
showResult=function(a){w||C[0].applyBounds({minRotation:-1E16*F,maxRotation:G});"invalidSpin"==a?(gsap.set(f,{rotation:g[n]}),showToast(ja),a={target:y,type:"error",spinCount:n,win:null,msg:ja,gameId:T},na(a),L.push(a)):isNaN(a)||(showToast(m[a].resultText),a={target:y,type:"result",spinCount:n,win:m[a].win,msg:m[a].resultText,gameId:T,userData:m[a].userData},oa(a),L.push(a))};showIntroText=function(a){showToast(Ha)};showInitError=function(a){gsap.set([Z,r],{autoAlpha:0});gsap.delayedCall(.1,function(){alert(a)})};
showToast=function(a){B.style.visibility="visible";ra.innerHTML=a;gsap.fromTo(B,{y:20,opacity:0},{duration:.6,y:0,opacity:1,delay:.2,ease:"elastic(0.7, 0.7)"})};checkNumSegments=function(){1>=u&&(showInitError("Not enough segments. Please add more entries to segmentValuesArray"),gsap.set(O,{visibility:"hidden"}))};setSpinTrigger=function(){r&&(w=!0);w&&(r?r.onclick=getTrigger():f.onclick=getTrigger())};checkRestriction=function(){onRestrict(la)};var oa=function(a){y.onResult(a)};var na=function(a){y.onError(a)};
var ma=function(a){y.onGameEnd(a)};onRestrict=function(a){y.onRestrict(a)};this.onResult=oa;this.onError=na;this.onGameEnd=ma;this.onRestrict=onRestrict;this.getGameProgress=function(){return L};this.init=function(a){a?(sa=a.data.svgWidth,O.setAttribute("viewBox","0 0 "+sa+" "+a.data.svgHeight),b=a.data,ma=a.onGameEnd?a.onGameEnd:function(){},oa=a.onResult?a.onResult:function(){},na=a.onError?a.onError:function(){},onRestrict=a.onRestrict?a.onRestrict:function(){},r=a.spinTrigger?a.spinTrigger:null,
setSpinTrigger(),aa=b.wheelStrokeColor,ba=b.wheelSize,q=ba/2,ua=b.wheelTextColor,aa=b.wheelStrokeColor,ta=b.wheelStrokeWidth,va=b.wheelTextOffsetY,wa=b.wheelImageOffsetY,Q=b.wheelImageSize,xa=b.wheelTextSize,ya=b.centerCircleStrokeColor,za=b.centerCircleStrokeWidth,Aa=b.centerCircleFillColor,Ba=b.centerCircleSize,Da=Ba/2,Ca=b.centerCircleImageUrl,ca=b.centerCircleImageWidth,da=b.centerCircleImageHeight,Ea=b.segmentStrokeColor,ea=b.segmentStrokeWidth,m=b.segmentValuesArray,u=m.length,v=-1==b.numSpins?
1E16:parseInt(b.numSpins),K=b.minSpinDuration,ia=b.maxSpinDuration<=b.minSpinDuration?b.minSpinDuration:b.maxSpinDuration,Ga=b.gameOverText,ja=b.invalidSpinText,Ha=b.introText,Ia=b.hasSound,T=b.gameId,k=360/u,Fa=k/2,d=b.centerX,e=b.centerY,I=b.colorArray,Ja=b.hasShadows,g=b.spinDestinationArray,F="cw"===b.spinDirection?-1:1,w=b.clickToSpin,Ma=b.disabledText,U=1080*F,La=500,la=b.restrictPlayDuration,Ja&&(Y.setAttributeNS(null,"filter","url(#shadow)"),A.setAttributeNS(null,"filter","url(#shadow)"),
qa.setAttributeNS(null,"filter","url(#shadow)"),pa.setAttributeNS(null,"filter","url(#shadow)"),B.style.boxShadow="0px 0px 20px rgba(21,21,21,0.5)"),onRestrict(la),Oa(),Xa(),Ua(),Y.appendChild(Ya()),qa.appendChild(Za()),Va(),checkNumSegments()):(Oa(),showInitError("PLEASE INCLUDE THE INIT OBJECT"))};this.restart=function(){w||(C[0].kill(),H=R=null,gsap.to([f,A],{duration:.3,rotation:"0_short",onComplete:Pa}));gsap.set(O,{opacity:1});gsap.to([f,A],{duration:.3,rotation:"0_short"});B.style.visibility=
"hidden";n=0;D=2;L=[];showIntroText()}}Spin2WinWheel.reset=function(){document.querySelector(".wheel").innerHTML="";document.querySelector(".wheelOutline").innerHTML="";document.querySelector(".centerCircle").innerHTML="";document.querySelector(".valueContainer").innerHTML="";document.querySelector(".centerCircleImageContainer").innerHTML="";gsap.set([".wheel",".valueContainer"],{rotation:0});gsap.set([".wheelSVG",".toast"],{opacity:gsap.utils.wrap([1,0])})};
Spin2WinWheel.hide=function(){gsap.set(".wheelContainer",{autoAlpha:0})};Spin2WinWheel.remove=function(){document.body.removeChild(document.querySelector(".wheelContainer"))};